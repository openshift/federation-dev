# Convert a Namespace to a Federated Namespace
Applications within OpenShift may already be deployed in an unfederated way. The `kubefedctl` tool will allow for a namespace and the objects within that namespace to become federated objects. This lab will deploy an application with a deployment and service and then use kubefedctl to federate the application and have it running on all three clusters. 

## Create a Namespace
To start with we will create a namespace for the *reverse-words* application to be deployed.

~~~sh
oc create ns --context cluster1 reverse-words
~~~

Now that the namespace exists deploy the deployment and service objects.
~~~sh
cd ~/federation-dev/labs/reverse-yaml
oc create -n reverse-words --context cluster1 -f 01-service.yaml
oc create -n reverse-words --context cluster1 -f 02-deployment.yaml
oc expose -n reverse-words --context cluster1 svc/reverse-words
~~~

Verify the application is running.
~~~sh
oc get all -n reverse-words --context cluster1
NAME                                 READY   STATUS    RESTARTS   AGE
pod/reverse-words-7fc48b5bd4-h9qlv   1/1     Running   0          14s

NAME                    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
service/reverse-words   ClusterIP   172.31.2.137   <none>        8080/TCP   16s

NAME                            READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/reverse-words   1/1     1            1           14s

NAME                                       DESIRED   CURRENT   READY   AGE
replicaset.apps/reverse-words-7fc48b5bd4   1         1         1       14s

NAME                                     HOST/PORT                                               PATH   SERVICES        PORT   TERMINATION   WILDCARD
route.route.openshift.io/reverse-words   reverse-words-reverse-words.apps.cluster-1.example.com          reverse-words   8080                 None
~~~

Use the oc client to display the route for the *reverse-words* application and use curl to reverse a word.
~~~sh
oc get route -n reverse-words --context cluster1
curl http://reverse-words-reverse-words.apps.cluster-1.example.com/ -X POST -d '{"word": "PALC"}'
{"reverse_word":"CLAP"}
~~~

## Federate Objects
Now that the application has been deployed and is operation; we will federate the object using the kubefedctl.

~~~sh
kubefedctl federate namespace reverse-words --host-cluster-context cluster1
~~~

Ensure that the namespace has been federated

~~~sh
for i in cluster1 cluster2 cluster3; do oc get ns reverse-words --context $i; done
NAME            STATUS   AGE
reverse-words   Active   3m52s
NAME            STATUS   AGE
reverse-words   Active   41s
NAME            STATUS   AGE
reverse-words   Active   42s
~~~

Now that the namespace has been federated let's federate the deployment and service so that the objects will be populated to the other clusters.

~~~sh
kubefedctl federate -n reverse-words deployments.apps reverse-words --host-cluster-context cluster1
kubefedctl federate -n reverse-words service reverse-words --host-cluster-context cluster1
~~~

Verify the objects are now federated. First, check the service.
~~~sh
for i in cluster1 cluster2 cluster3; do oc get svc -n reverse-words; done
NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
reverse-words   ClusterIP   172.31.48.208   <none>        8080/TCP   11m
NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
reverse-words   ClusterIP   172.31.48.208   <none>        8080/TCP   11m
NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
reverse-words   ClusterIP   172.31.48.208   <none>        8080/TCP   11m
~~~

Next, check the deployment.
~~~sh
for i in cluster1 cluster2 cluster3; do oc get deployment -n reverse-words; done
NAME            READY   UP-TO-DATE   AVAILABLE   AGE
reverse-words   1/1     1            1           12m
NAME            READY   UP-TO-DATE   AVAILABLE   AGE
reverse-words   1/1     1            1           12m
NAME            READY   UP-TO-DATE   AVAILABLE   AGE
reverse-words   1/1     1            1           12m
~~~~

On the other clusters let's expose the service so that we can use the application there as well.
~~~sh
oc expose svc/reverse-words -n reverse-words --context cluster2
oc expose svc/reverse-words -n reverse-words --context cluster3
~~~

This concludes the lab on changing a deployment, namespace, and service objects to become federated objects.

If a mistake was made, please let an instructor know, and review the [cleanup instructions](./cleanup-instructions.md).

Next Lab: [Lab 9 - Replica Scheduling](./9.md)<br>
Previous Lab: [Lab 7 - Application Portability](./7.md)<br>
[Home](../README.md)